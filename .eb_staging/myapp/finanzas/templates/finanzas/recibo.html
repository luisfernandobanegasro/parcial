<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Recibo {{ documento.numero|default:documento.id }}</title>
    <style>
      body { font-family: sans-serif; font-size: 12px; color: #222; }
      h1 { font-size: 18px; margin: 0 0 4px; }
      .muted { color: #666; }
      table { width: 100%; border-collapse: collapse; margin-top: 12px; }
      th, td { border: 1px solid #ddd; padding: 6px; text-align: left; }
      .right { text-align: right; }
    </style>
  </head>
  <body>
    <h1>Recibo {{ documento.numero|default:"S/N" }}</h1>

    {# intentar extraer información del pago a partir del primer detalle #}
    {% with primer_det=detalles.0 %}
      {% if primer_det %}
        <div class="muted">Fecha de pago: {{ primer_det.pago.fecha|date:"Y-m-d H:i" }} | Medio: {{ primer_det.pago.medio }} | Moneda: {{ documento.moneda }}</div>
      {% else %}
        <div class="muted">Generado: {{ hoy|date:"Y-m-d H:i" }} | Moneda: {{ documento.moneda }}</div>
      {% endif %}
    {% endwith %}

    <table>
      <tr><th style="width:40%">Documento ID</th><td style="width:60%">{{ documento.id }}</td></tr>
      <tr><th>Tipo</th><td>{{ documento.tipo }}</td></tr>
      <tr><th>Condominio</th><td>{{ documento.condominio }}</td></tr>
      {% if unidad %}
        <tr><th>Unidad</th><td>{{ unidad }}</td></tr>
      {% endif %}
    </table>

    <h3>Detalle del pago</h3>
    <table>
      <thead>
        <tr>
          <th style="width:5%">#</th>
          <th style="width:45%">Concepto</th>
          <th style="width:20%">Periodo</th>
          <th style="width:15%" class="right">Monto</th>
        </tr>
      </thead>
      <tbody>
        {% for d in detalles %}
          <tr>
            <td>{{ forloop.counter }}</td>
            <td>
              {% if d.cargo.concepto.codigo %} {{ d.cargo.concepto.codigo }} - {% endif %}
              {{ d.cargo.concepto.nombre }}
            </td>
            <td>
              {% if d.cargo.periodo %}
                {{ d.cargo.periodo }}
              {% else %}
                -
              {% endif %}
            </td>
            <td class="right">{{ d.monto_aplicado|floatformat:2 }}</td>
          </tr>
        {% empty %}
          <tr><td colspan="4">No hay detalles asociados a este documento.</td></tr>
        {% endfor %}
      </tbody>
      <tfoot>
        <tr>
          <th colspan="3" class="right">TOTAL</th>
          <th class="right">{{ documento.total|floatformat:2 }}</th>
        </tr>
      </tfoot>
    </table>

    <p class="muted">Este comprobante fue generado automáticamente por {{ SITE_NAME }}.</p>
  </body>
</html>
